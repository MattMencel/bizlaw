<div class="space-y-6">
  <% teams_by_simulation.each do |simulation, teams| %>
    <div class="bg-white shadow rounded-lg">
      <!-- Simulation Header -->
      <div class="bg-purple-50 px-6 py-4 border-b border-purple-100 rounded-t-lg">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-semibold text-purple-900 flex items-center space-x-2">
              <span>ðŸŽ¯</span>
              <span><%= simulation.display_name %></span>
            </h3>
            <div class="text-sm text-purple-600 mt-1">
              <span><%= simulation.case.title %></span>
              <span class="text-purple-400 mx-2">â€¢</span>
              <span><%= simulation.case.course.display_name %> (<%= simulation.case.course.course_code %>)</span>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-purple-600 mb-1">
              <%= pluralize(teams.count, 'team') %>
            </div>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
              <%= simulation.status == 'active' ? 'bg-green-100 text-green-800' :
                  simulation.status == 'completed' ? 'bg-gray-100 text-gray-800' :
                  'bg-yellow-100 text-yellow-800' %>">
              <%= simulation.status.titleize %>
            </span>
          </div>
        </div>

        <!-- Simulation Progress -->
        <div class="mt-3">
          <div class="flex items-center justify-between text-sm text-purple-600 mb-1">
            <span>Phase <%= simulation.current_phase %> of <%= simulation.total_rounds %></span>
            <span><%= ((simulation.current_phase.to_f / simulation.total_rounds) * 100).round %>% Complete</span>
          </div>
          <div class="w-full bg-purple-200 rounded-full h-2">
            <div class="bg-purple-600 h-2 rounded-full"
                 style="width: <%= ((simulation.current_phase.to_f / simulation.total_rounds) * 100).round %>%"></div>
          </div>
        </div>
      </div>

      <!-- Teams in this simulation -->
      <div class="p-6">
        <div class="grid gap-4 md:grid-cols-2">
          <% teams.each do |team| %>
            <%= turbo_frame_tag dom_id(team), data: { team_id: team.id } do %>
              <div class="border border-gray-200 rounded-lg p-4 hover:border-purple-300 hover:shadow-sm transition-all">
                <!-- Team Header -->
                <div class="flex items-start justify-between mb-3">
                  <div class="flex-1">
                    <div class="flex items-center space-x-2 mb-1">
                      <h5 class="font-semibold text-gray-900"><%= team.name %></h5>
                      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
                        <%= team.role == 'plaintiff' ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800' %>">
                        <%= team.role.titleize %>
                      </span>
                    </div>
                    <p class="text-sm text-gray-600 line-clamp-2"><%= team.description %></p>
                  </div>
                </div>

                <!-- Team Stats -->
                <div class="flex items-center justify-between text-sm mb-3">
                  <div class="flex items-center space-x-4">
                    <span class="flex items-center text-gray-600">
                      ðŸ‘¥ <%= team.member_count %>/<%= team.max_members %> members
                    </span>
                    <% if team.full? %>
                      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        Full
                      </span>
                    <% end %>
                  </div>
                  <div class="text-gray-500">
                    Owner: <%= team.owner.display_name %>
                  </div>
                </div>

                <!-- Course Info -->
                <div class="text-xs text-gray-500 mb-3">
                  Course: <%= team.course.display_name %> (<%= team.course.course_code %>)
                </div>

                <!-- Quick Actions -->
                <div class="flex space-x-2">
                  <%= link_to "View Team", team_path(team),
                      class: "inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-purple-500",
                      data: { turbo_frame: "_top" } %>
                  <%= link_to "View Simulation", simulation_path(simulation),
                      class: "inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-purple-500",
                      data: { turbo_frame: "_top" } %>
                  <%= link_to "View Course", course_path(team.course),
                      class: "inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-purple-500",
                      data: { turbo_frame: "_top" } %>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <% if teams_by_simulation.empty? %>
    <div class="text-center py-12">
      <div class="text-gray-400 text-6xl mb-4">ðŸŽ¯</div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No simulations found</h3>
      <p class="text-gray-500">Teams are organized by their active simulations.</p>
    </div>
  <% end %>
</div>
